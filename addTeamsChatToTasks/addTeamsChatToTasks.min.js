window.dkr=window.dkr||{},dkr.addTeamsChatToTasks={},dkr.addTeamsChatToTasks.DOMUpdateDelay=50,dkr.addTeamsChatToTasks.taskList=null,dkr.addTeamsChatToTasks.message=null,dkr.addTeamsChatToTasks.addUrlToMessage=!1,dkr.addTeamsChatToTasks.useWebApp=!1,dkr.addTeamsChatToTasks.addTaskArrayToTaskList=function(a){a.forEach((a=>{null!=a.taskId&&0==a.toGroup&&a.userLogin.indexOf("@")>-1&&(dkr.addTeamsChatToTasks.taskList[a.taskId]=a)}))},dkr.addTeamsChatToTasks.createTaskList=async function(){if(!window.ccls||!window.ccls.utils)return void console.warn("Common functions (utils.js) has not been loaded.");let a=await ccls.utils.getLiteModel();dkr.addTeamsChatToTasks.taskList={},dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.otherTasks.ccCoversTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.otherTasks.ccTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.otherTasks.directCoversTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.otherTasks.directTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.standardTasks.ccCoversTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.standardTasks.ccTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.standardTasks.directCoversTasks),dkr.addTeamsChatToTasks.addTaskArrayToTaskList(a.formInfo.tasksInfo.standardTasks.directTasks)},dkr.addTeamsChatToTasks.replaceUserWithTeamsLink=async function(){const a=document.querySelector(".formElementInfoPanel");if(null!=a){if(null==dkr.addTeamsChatToTasks.taskList&&await dkr.addTeamsChatToTasks.createTaskList(),null==dkr.addTeamsChatToTasks.taskList)return;Object.keys(dkr.addTeamsChatToTasks.taskList).forEach((s=>{let d=dkr.addTeamsChatToTasks.taskList[s],t=dkr.addTeamsChatToTasks.message||"";if(dkr.addTeamsChatToFields.addUrlToMessage){let a=document.location.href.substring(0,document.location.href.length-document.location.search.length);a=a.replace("edit","").replace("admin",""),t+=" "+a}let e=document.querySelector(`div[data-task-id='${d.taskId}'] .form-status-panel`,a);e.insertAdjacentHTML("beforeEnd",`\n                <i class="icon ms-Icon ms-Icon--TeamsLogo ms-Icon--small form-status-panel__icon" aria-hidden="true" data-disabled="false"></i>                \n                <a href="${dkr.addTeamsChatToTasks.useWebApp?"https://teams.microsoft.com":"msteams:"}/l/chat/0/0?users=${d.userLogin}&message=${encodeURIComponent(t)}" ${dkr.addTeamsChatToTasks.useWebApp?'target="_blank"':null}>\n                </a>\n                `);let T=e.querySelector("span");T.style.minWidth="100%",e.querySelector("a").appendChild(T)}))}},dkr.addTeamsChatToTasks.attachInfoButtonClick=function(){const a=document.querySelector("button.infoBtn");a&&a.addEventListener("click",dkr.addTeamsChatToTasks.infoButtonClick)},dkr.addTeamsChatToTasks.attachInfoPanelDetailsClick=function(){const a=document.querySelector("i.ms-Icon--Storyboard");if(a){const s=a.closest("div");s&&s.addEventListener("click",dkr.addTeamsChatToTasks.infoPanelDetailsClick)}},dkr.addTeamsChatToTasks.infoButtonClick=function(){setTimeout((()=>{dkr.addTeamsChatToTasks.attachInfoPanelDetailsClick(),dkr.addTeamsChatToTasks.replaceUserWithTeamsLink()}),dkr.addTeamsChatToTasks.DOMUpdateDelay)},dkr.addTeamsChatToTasks.infoPanelDetailsClick=function(){setTimeout(dkr.addTeamsChatToTasks.replaceUserWithTeamsLink,dkr.addTeamsChatToTasks.DOMUpdateDelay)},dkr.addTeamsChatToTasks.init=function(a){void 0===a&&(a=200),setTimeout((()=>{dkr.addTeamsChatToTasks.attachInfoButtonClick(),dkr.addTeamsChatToTasks.attachInfoPanelDetailsClick(),dkr.addTeamsChatToTasks.replaceUserWithTeamsLink()}),a)},console.log("Add teams chat to tasks logic has been loaded.");