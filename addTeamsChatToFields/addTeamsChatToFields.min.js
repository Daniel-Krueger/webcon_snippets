window.dkr=window.dkr||{},dkr.addTeamsChatToFields={},dkr.addTeamsChatToFields.message=null,dkr.addTeamsChatToFields.addUrlToMessage=!1,dkr.addTeamsChatToFields.useWebApp=!1,dkr.addTeamsChatToFields.getUserUPNsBusinessRuleId=null,dkr.addTeamsChatToFields.getUserUPNsBusinessRuleParameterId=null,dkr.addTeamsChatToFields.getUserUPNsBusinessRuleName="GetUserUPNs",dkr.addTeamsChatToFields.userFields=[],dkr.addTeamsChatToFields.updateFields=function(){dkr.addTeamsChatToFields.userFields.forEach((e=>{setTimeout(dkr.addTeamsChatToFields.wrapInAnchor(e,1,4),10)}))},dkr.addTeamsChatToFields.wrapInAnchor=function(e,s,a){const d=document.getElementById(e);if(d){const s=d.querySelector("span.attributeLabelDisplayName");if(s&&"dkrTeamsLink"!=s.parentElement.className){const a=document.createElement("a");a.className="dkrTeamsLink",a.style.whiteSpace="nowrap",a.onclick=e=>{dkr.addTeamsChatToFields.startChat(e)},a.onclick=(t=e,function(){dkr.addTeamsChatToFields.startChat(t)}),s.parentElement.appendChild(a),a.insertAdjacentHTML("afterbegin",'<i class="icon ms-Icon ms-Icon--TeamsLogo ms-Icon--small form-status-panel__icon" aria-hidden="true" data-disabled="false"></i>'),a.appendChild(s)}}else s<=a&&setTimeout((()=>{s++,dkr.addTeamsChatToFields.wrapInAnchor(e,s,a)}),10);var t},dkr.addTeamsChatToFields.startChat=function(e){const s=GetPairID(GetValue(e)),a={};a[dkr.addTeamsChatToFields.getUserUPNsBusinessRuleParameterId]=s,window.webcon.businessRules.executeBusinessRule(dkr.addTeamsChatToFields.getUserUPNsBusinessRuleId,`${dkr.addTeamsChatToFields.getUserUPNsBusinessRuleName} (ID:${dkr.addTeamsChatToFields.getUserUPNsBusinessRuleId})`,{},a).then((function(e){""!=e.toString()&&dkr.addTeamsChatToFields.openTeamsUrl(e)}))},dkr.addTeamsChatToFields.openTeamsUrl=function(e){console.log(`Starting teams chat for users: '${e}'`);let s=encodeURIComponent(e.replaceAll(";",",")),a=dkr.addTeamsChatToFields.message||"";if(dkr.addTeamsChatToFields.addUrlToMessage){let e=document.location.href.substring(0,document.location.href.length-document.location.search.length);e=e.replace("edit","").replace("admin",""),a+=" "+e}dkr.addTeamsChatToFields.useWebApp?window.open(`https://teams.microsoft.com:/l/chat/0/0?users=${s}&message=${encodeURIComponent(a)}`,"_blank"):window.open(`msteams:/l/chat/0/0?users=${s}&message=${encodeURIComponent(a)}`)},console.log("Add teams chat to fields logic has been loaded.");