window.dkr=window.dkr||{},dkr.addTeamsChatToFields={},dkr.addTeamsChatToFields.message=null,dkr.addTeamsChatToFields.addUrlToMessage=!1,dkr.addTeamsChatToFields.useWebApp=!1,dkr.addTeamsChatToFields.getUserUPNsBusinessRuleId=null,dkr.addTeamsChatToFields.getUserUPNsBusinessRuleParameterId=null,dkr.addTeamsChatToFields.getUserUPNsBusinessRuleName="GetUserUPNs",dkr.addTeamsChatToFields.userFields=[],dkr.addTeamsChatToFields.updateFields=function(){dkr.addTeamsChatToFields.userFields.forEach((e=>{setTimeout(dkr.addTeamsChatToFields.wrapInAnchor(e,1,4),10)}))},dkr.addTeamsChatToFields.wrapInAnchor=function(e,s,a){const d=document.getElementById(e);if(d){const s=d.querySelector("span.attributeLabelDisplayName");if(s&&"dkrTeamsLink"!=s.parentElement.className){const a=document.createElement("a");a.className="dkrTeamsLink",a.onclick=e=>{dkr.addTeamsChatToFields.startChat(e)},a.onclick=(t=e,function(){dkr.addTeamsChatToFields.startChat(t)}),s.parentElement.appendChild(a),a.insertAdjacentHTML("afterbegin",'<i class="icon ms-Icon ms-Icon--TeamsLogo ms-Icon--small form-status-panel__icon" aria-hidden="true" data-disabled="false"></i>'),a.appendChild(s)}}else s<=a&&setTimeout((()=>{s++,dkr.addTeamsChatToFields.wrapInAnchor(e,s,a)}),10);var t},dkr.addTeamsChatToFields.replaceUserWithTeamsLink=async function(){const e=document.querySelector(".formElementInfoPanel");if(null!=e){if(null==dkr.addTeamsChatToFields.taskList&&await dkr.addTeamsChatToFields.createTaskList(),null==dkr.addTeamsChatToFields.taskList)return;Object.keys(dkr.addTeamsChatToFields.taskList).forEach((s=>{let a=dkr.addTeamsChatToFields.taskList[s],d=dkr.addTeamsChatToFields.message||"";dkr.addTeamsChatToFields.addUrlToMessage&&(d+=" "+document.location.href.substring(0,document.location.href.length-document.location.search.length));let t=document.querySelector(`div[data-task-id='${a.taskId}'] .form-status-panel`,e);t.insertAdjacentHTML("beforeEnd",`\n                <i class="icon ms-Icon ms-Icon--TeamsLogo ms-Icon--small form-status-panel__icon" aria-hidden="true" data-disabled="false"></i>                \n                <a href="${dkr.addTeamsChatToFields.useWebApp?"https://teams.microsoft.com":"msteams:"}/l/chat/0/0?users=${a.userLogin}&message=${encodeURIComponent(d)}" ${dkr.addTeamsChatToFields.useWebApp?'target="_blank"':null}>\n                </a>\n                `);let o=t.querySelector("span");o.style.minWidth="100%",t.querySelector("a").appendChild(o)}))}},dkr.addTeamsChatToFields.startChat=function(e){const s=GetPairID(GetValue(e)),a={};a[dkr.addTeamsChatToFields.getUserUPNsBusinessRuleParameterId]=s,window.webcon.businessRules.executeBusinessRule(dkr.addTeamsChatToFields.getUserUPNsBusinessRuleId,`${dkr.addTeamsChatToFields.getUserUPNsBusinessRuleName} (ID:${dkr.addTeamsChatToFields.getUserUPNsBusinessRuleId})`,{},a).then((function(e){""!=e.toString()&&dkr.addTeamsChatToFields.openTeamsUrl(e)}))},dkr.addTeamsChatToFields.openTeamsUrl=function(e){console.log(`Starting teams chat for users: '${e}'`);let s=encodeURIComponent(e.replace(";",",")),a=dkr.addTeamsChatToFields.message||"";dkr.addTeamsChatToFields.addUrlToMessage&&(a+=" "+document.location.href.substring(0,document.location.href.length-document.location.search.length)),dkr.addTeamsChatToFields.useWebApp?window.open(`https://teams.microsoft.com:/l/chat/0/0?users=${s}&message=${encodeURIComponent(a)}`,"_blank"):window.open(`msteams:/l/chat/0/0?users=${s}&message=${encodeURIComponent(a)}`)},console.log("Add teams chat to fields logic has been loaded.");