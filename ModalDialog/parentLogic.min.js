window.ccls=window.ccls||{},ccls.modal=ccls.modal||{},ccls.modal.dialog=ccls.modal.dialog||{},ccls.modal.dialog.replaceWindowBehavior,ccls.modal.dialog.startDebugger=function(){if("modalDialogParent"==new URLSearchParams(document.location.search).get("debug")){debugger;return!0}return!1},ccls.modal.dialog.closingTimeout=null,ccls.modal.dialog.closeFunctions=ccls.modal.dialog.closeFunctions||{},ccls.modal.dialog.closeFunctions.executeRefreshButton=function(o){if(!ccls.utils.continueAlsoPageIsDirty)return;let e=$("#ReloadToolbarButton");1==e.length&&e[0].click()},ccls.modal.dialog.closeFunctions.setInstanceIdForField=function(o,e){null!=o?SetValue(e,o.instanceId):console.log("No parameters have been provided")},ccls.modal.dialog.closeFunctions.setInstanceIdForItemListColumn=function(o,e,l,n){null!=o?void 0===n||-1===n?SetSubValue(e,SubelementCountRows(e),l,o.instanceId):SetSubValue(e,n,l,o.instanceId):console.log("No parameters have been provided")},ccls.modal.dialog.closeFunctions.setGuidForField=async function(o,e){if(null==o)return void console.log("No parameters have been provided");const l=await ccls.utils.getSpecificLiteModel(o.dbId,o.instanceId);ccls.modal.dialog.startDebugger(),SetValue(e,l.liteData.liteModel.formInfo.guid)},ccls.modal.dialog.closeFunctions.setGuidForItemListColumn=async function(o,e,l,n){if(null==o)return void console.log("No parameters have been provided");const t=await ccls.utils.getSpecificLiteModel(o.dbId,o.instanceId);ccls.modal.dialog.startDebugger(),void 0===n||-1===n?SetSubValue(e,SubelementCountRows(e),l,t.liteData.liteModel.formInfo.guid):SetSubValue(e,n,l,t.liteData.liteModel.formInfo.guid)},ccls.modal.dialog.customClosingFunction=void 0,ccls.modal.dialog.close=function(o){ccls.modal.dialog.startDebugger(),document.removeEventListener("keydown",ccls.modal.dialog.closeOnEscape),document.getElementById("cclsModaliframe").contentWindow.postMessage(new Message("parentClosing",o)),ccls.modal.dialog.closingTimeout=setTimeout((()=>{console.log("Closing modal due to timeout"),ccls.modal.dialog.childClosed(o)}),100)},ccls.modal.dialog.closeOnEscape=function(o){"Escape"===o.key&&ccls.modal.dialog.close()},ccls.modal.dialog.childClosed=function(o){clearTimeout(ccls.modal.dialog.closingTimeout),document.getElementById("cclsModal").style.display="none",ccls.modal.dialog.customClosingFunction!=ccls.modal.dialog.closeFunctions.executeRefreshButton?($(".reload-button-container").find("button").each(((o,e)=>{setTimeout((()=>{e.click()}),122*o)})),$(".reload-button-container").find("span").each(((o,e)=>{setTimeout((()=>{e.click()}),99*o)})),"function"==typeof ccls.modal.dialog.customClosingFunction&&ccls.modal.dialog.customClosingFunction(o)):ccls.modal.dialog.closeFunctions.executeRefreshButton()},ccls.modal.dialog.displayAttachment=function(o,e,l){if(null!=e){void 0===e.dbId&&(e.dbId=ccls.utils.getIdFromUrl("db"));var n=`/attachments/db/${e.dbId}/preview/${e.attachmentId}?hash=`+Date.now();console.log(`Display attachment: '${n}'`),ccls.modal.dialog.internalOpen('"default":"'+o+'"',n,l,null,!1)}else console.log("No parameters have been provided")},ccls.modal.dialog.displayExternalPage=function(o,e,l){ccls.modal.dialog.startDebugger(),ccls.modal.dialog.internalOpen('"default":"'+o+'"',e,l,null,!1)},ccls.modal.dialog.displayWorkflow=function(o,e,l,n,t){ccls.modal.dialog.startDebugger(),console.log(e);let a=JSON.parse("{"+e+"}");if("number"!=typeof a.dbId&&(a.dbId=ccls.utils.getIdFromUrl("db")),"number"!=typeof a.elementId)return void alert(`Element id is not a number, passed value '${a.workflowId}'`);let d=ccls.modal.dialog.getSearchParams(l),c=`/embed/form/db/${a.dbId}/element/${a.elementId}/form?${d.toString()}&theme=${window.initModel.userTheme}`;ccls.modal.dialog.internalOpen(o,c,n,t,!0)},ccls.modal.dialog.startWorkflow=function(o,e,l,n,t){ccls.modal.dialog.startDebugger(),console.log(e);let a=JSON.parse("{"+e+"}");if("number"!=typeof a.dbId&&(a.dbId=ccls.utils.getIdFromUrl("db")),"number"!=typeof a.workflowId)return void alert(`Workflow id is not a number, passed value '${a.workflowId}'`);if("number"!=typeof a.formTypeId)return void alert(`Form type id is not a number, passed value '${a.formTypeId}'`);let d=ccls.modal.dialog.getSearchParams(l);"number"!=typeof a.businessEntity&&(a.businessEntity=GetPairID(G_COM)),d.append("com_id",a.businessEntity),"number"==typeof a.parentInstance&&d.append("parent_wfdid",a.parentInstance);let c=`/embed/form/db/${a.dbId}/start/wf/${a.workflowId}/dt/${a.formTypeId}/form?${d.toString()}&theme=${window.initModel.userTheme}`;ccls.modal.dialog.internalOpen(o,c,n,t,!0)},ccls.modal.dialog.internalOpen=function(o,e,l,n,t){console.log(e);let a=JSON.parse("{"+o+"}"),d=a[window.initModel.userLang.substr(0,2)];void 0===d&&(d=a.default),ccls.modal.dialog.replaceWindowBehavior=void 0===t||1==t?"workflowInstance":"external",document.getElementById("cclsModaliframe").src=e,document.getElementById("cclsModalTitle").innerText=d,document.getElementById("cclsModal").style.display="block",null!=l&&(G_ISMOBILE&&(l=" height:95%; width:95%"),$(".modal-window").attr("style","z-index: 2003;"+l)),document.addEventListener("keydown",ccls.modal.dialog.closeOnEscape),"function"==typeof n&&(ccls.modal.dialog.customClosingFunction=n)},ccls.modal.dialog.getSearchParams=function(o){console.log(o);let e=JSON.parse("{"+o+"}"),l=new URLSearchParams("isModal=1");for(const o in e){let n=e[o];n.toString().indexOf("WFD_")>-1&&(n=GetValue(n.replace("WFD_",""))),l.append(o,encodeURIComponent(n))}return ccls.modal.dialog.startDebugger()&&l.append("debug","modalDialogChild"),l},ccls.modal.dialog.startingLayoutDefinitionStyle=null,ccls.modal.dialog.toggleExpand=function(){ccls.modal.dialog.startDebugger(),$("#cclsModalLayoutDefinition").hasClass("expanded")?($("#cclsModalLayoutDefinition").removeClass("expanded"),$("#cclsModalLayoutDefinition").attr("style",ccls.modal.dialog.startingLayoutDefinitionStyle),$("#cclsExpandButtonIcon").addClass("ms-Icon--FullScreen"),$("#cclsExpandButtonIcon").removeClass("ms-Icon--BackToWindow")):(ccls.modal.dialog.startingLayoutDefinitionStyle=$("#cclsModalLayoutDefinition").attr("style"),$("#cclsModalLayoutDefinition").addClass("expanded"),$("#cclsModalLayoutDefinition").attr("style","z-index: 2003;height: 95%; width: 95%;"),$("#cclsExpandButtonIcon").addClass("ms-Icon--BackToWindow"),$("#cclsExpandButtonIcon").removeClass("ms-Icon--FullScreen"))},ccls.modal.dialog.replaceWindow=function(){ccls.modal.dialog.startDebugger(),"workflowInstance"==ccls.modal.dialog.replaceWindowBehavior?document.getElementById("cclsModaliframe").contentWindow.postMessage(new Message("sendURL",null)):(console.log("open iframe url in new tab"),window.open(document.getElementById("cclsModaliframe").src,"_blank"))},ccls.modal.dialog.dialogHtml='<style>\n  #cclsModalLayoutDefinition  > header {\n    cursor:move;\n  }\n  </style>\n  <div id="cclsModal" class="modal-outer" style="display:none">\n    <div\n      id="cclsModalLayoutDefinition"\n      class="modal-window animation100 modal-window--large"\n      style="z-index: 2003"\n    >\n      <header>\n        <div class="title-container expandable">\n          <div class="title" id="cclsModalTitle"></div>\n          <div class="subtitle"></div>\n        </div>\n\n        <div class="actions">\n        \x3c!-- reusing the expand class to match the styling, but moving the position of the element with the style; depending on the media size, it\'s not visible therefore display block--\x3e\n          <div id="cclsOpenInNewWindow" class="expand" style="right: 60px;display:block">\n            <button\n              class="webcon-button webcon-button--padding-default standard-focus webcon-button--icon-button no-hover no-background th-hover"\n              aria-label="Close"\n              tabindex="0"\n              type="button"\n            >\n            <i class="icon ms-Icon ms-Icon--OpenInNewWindow ms-Icon--standard" aria-hidden="true" data-disabled="false"></i>\n         \n            </button>\n            </div>\n          <div id="cclsExpandDialog" class="expand" style="display:block">\n            <button\n              class="webcon-button webcon-button--padding-default standard-focus webcon-button--icon-button no-hover no-background th-hover"\n              aria-label="Full screen"\n              tabindex="0"\n              type="button"\n            >\n              <i\n                id="cclsExpandButtonIcon"\n                class="icon ms-Icon ms-Icon--FullScreen ms-Icon--standard"\n                aria-hidden="true"\n                data-disabled="false"\n              ></i>\n            </button>\n          </div>\n          <div id="cclsCloseDialog" class="close">\n            <button\n              class="webcon-button webcon-button--padding-default standard-focus webcon-button--icon-button no-hover no-background th-hover"\n              aria-label="Close"\n              tabindex="0"\n              type="button"\n            >\n              <i\n                class="icon ms-Icon ms-Icon--ChromeClose ms-Icon--standard"\n                aria-hidden="true"\n                data-disabled="false"\n              ></i>\n            </button>\n          </div>\n        </div>\n      </header>\n      <iframe id="cclsModaliframe" height="100%"></iframe>\n    </div>\n    <div class="modal-background animation04" style="z-index: 2002"></div>\n  </div>\n\n',$("#formContainer").append(ccls.modal.dialog.dialogHtml),$("#cclsCloseDialog > button").on("click",(function(){ccls.modal.dialog.close()})),$("#cclsExpandDialog > button").on("click",(function(){ccls.modal.dialog.toggleExpand()})),$("#cclsOpenInNewWindow > button").on("click",(function(){ccls.modal.dialog.replaceWindow()})),ccls.modal.dialog.dragElement=function(o){var e=0,l=0,n=0,t=0;function a(a){(a=a||window.event).preventDefault(),e=n-a.clientX,l=t-a.clientY,n=a.clientX,t=a.clientY,o.style.top=o.offsetTop-l+"px",o.style.left=o.offsetLeft-e+"px"}function d(){document.onmouseup=null,document.onmousemove=null}o.onmousedown=function(o){(o=o||window.event).preventDefault(),n=o.clientX,t=o.clientY,document.onmouseup=d,document.onmousemove=a}},ccls.modal.dialog.dragElement(document.querySelector("#cclsModalLayoutDefinition"));class Message{constructor(o,e){this.type=o,this.body=e}}void 0!==ccls.modal.dialog.abortController&&ccls.modal.dialog.abortController.abort("Cleaning up parent logic post message handler"),ccls.modal.dialog.abortController=new AbortController,ccls.modal.dialog.parentMessageHandler=function(o){if(o.data){let e=o.data;if("fullUrl"==e.type){e.body.url.indexOf("?")>-1?e.body.url+="&":e.body.url+="?";let o=e.body.url+"returnUrl="+encodeURIComponent(document.location.href);window.open(o,"_blank")}"childClosed"==e.type&&ccls.modal.dialog.childClosed(e.body)}},window.addEventListener("message",ccls.modal.dialog.parentMessageHandler,{signal:ccls.modal.dialog.abortController.signal}),console.log("modal dialog parent logic executed");