window.dkr=window.dkr||{},dkr.missingRequiredFieldsHandler=dkr.missingRequiredFieldsHandler||{},dkr.missingRequiredFieldsHandler.erroneousFields=[],dkr.missingRequiredFieldsHandler.rowLabelForRegEx={de:"Zeile",en:"row",pl:"wiersz",it:"riga",sl:"vrstica",ro:"Rand"},dkr.missingRequiredFieldsHandler.preventLeavingFieldWithError=!0,dkr.missingRequiredFieldsHandler.VersionDependingValues=[{version:"0.0.0.0",values:{getFieldFromControls:async function(e){return(await ccls.utils.getLiteModel()).controls.find((i=>i.displayName==e&&(0==i.fieldName.indexOf("Att")||0==i.fieldName.indexOf("SubElems"))))}}},{version:"2023.1.1.1",values:{getFieldFromControls:async function(e){return(await ccls.utils.getLiteModel()).controls.find((i=>i.name.translated==e&&(0==i.fieldName.indexOf("Att")||0==i.fieldName.indexOf("SubElems"))))}}}],dkr.missingRequiredFieldsHandler.versionValues=ccls.utils.getVersionValues(dkr.missingRequiredFieldsHandler.VersionDependingValues),dkr.missingRequiredFieldsHandler.handleTabClickInErroneousField=function(e,i,r){e.preventDefault(),nextField=dkr.missingRequiredFieldsHandler.erroneousFields[r+1],null==nextField&&(nextField=dkr.missingRequiredFieldsHandler.erroneousFields[0]),eventObject=new Event("focusout",{bubbles:!0}),i.dispatchEvent(eventObject),setTimeout((()=>{dkr.missingRequiredFieldsHandler.ensureNoMoreErrorsInCurrentField(i,nextField)}),50)},dkr.missingRequiredFieldsHandler.ensureNoMoreErrorsInCurrentField=function(e,i){if(dkr.missingRequiredFieldsHandler.preventLeavingFieldWithError){let i=e.parentNode;for(;!(i==document||i.classList&&i.classList.contains("stylePanel"));)i=i.parentNode;const r=i.querySelector(".attributeErrorsPanel");if(r&&r.children.length>0)return void console.log("Not leaving the field, there's still an error")}console.log("Calling set focus for:"+i),SetFocus(i),setTimeout((()=>{dkr.missingRequiredFieldsHandler.handleSpecialFields(i)}),200)},dkr.missingRequiredFieldsHandler.handleSpecialFields=function(e){if(e.indexOf("AttDateTime")>-1&&(document.querySelector(`#${e.substring(0,e.indexOf("_"))} .date-time-control__button`).click(),setTimeout((()=>{new MutationObserver(((i,r)=>{i[0].removedNodes.length>0&&(console.log("Refocus field after closing date time picker: "+e),SetFocus(e),r.disconnect())})).observe(document.getElementsByTagName("body")[0],{subtree:!0,childList:!0})}),200)),e.indexOf("AttChoose")>-1){let i=document.querySelector(`#${e.substring(0,e.indexOf("_"))} .picker-search-button`);i&&(i.click(),setTimeout((()=>{new MutationObserver(((i,r)=>{if(i[0].removedNodes.length>0&&i[0].removedNodes[0].classList.contains("modal-outer")){console.log("Refocus field after closing popup search: "+e);let i=document.querySelector(`#${e.substring(0,e.indexOf("_"))} .picker-check-button`);i&&i.focus(),r.disconnect()}})).observe(document.getElementById("Modals"),{subtree:!0,childList:!0})}),100))}},dkr.missingRequiredFieldsHandler.MutationCallback=async function(e,i){if(dkr.missingRequiredFieldsHandler.observerCounter++,console.log("Missing required field observer counter "+dkr.missingRequiredFieldsHandler.observerCounter),isErrorDialog=!1,e?.[0]?.addedNodes?.[0]?isErrorDialog=e[0].addedNodes[0].children?.[0]?.classList.contains("form-error-modal"):e?.[0]?.removedNodes?.[0]&&(isErrorDialog=e[0].removedNodes[0].children?.[0]?.classList.contains("form-error-modal")),1!=isErrorDialog)return;if(-1==document.location.href.indexOf("/element/")&&-1==document.location.href.indexOf("/start/")&&(console.log("Disconnecting missing required fields observer for "+document.location.href),dkr.missingRequiredFieldsHandler.abortController.abort("Cleaning up event listener"),i.disconnect()),null!=document.getElementById("missingCommentContinueButton"))return;if(e[0].removedNodes.length>0)return void(dkr.missingRequiredFieldsHandler.erroneousFields.length>0&&-1==dkr.missingRequiredFieldsHandler.erroneousFields[0].indexOf("SubElems")&&(SetFocus(dkr.missingRequiredFieldsHandler.erroneousFields[0]),setTimeout((()=>{dkr.missingRequiredFieldsHandler.handleSpecialFields(dkr.missingRequiredFieldsHandler.erroneousFields[0])}),100)));let r=document.querySelectorAll(".form-error-modal div.form-errors-panel__errors-container__error");dkr.missingRequiredFieldsHandler.erroneousFields=[];let s=dkr.missingRequiredFieldsHandler.rowLabelForRegEx[window.initModel.userLang.substr(0,2)];if(!s)return void alert("Label for 'row' is not defined for language :'"+window.initModel.userLang.substr(0,2));let n=[];await ccls.utils.getLiteModel(),r.forEach((e=>{let i=e.getAttribute("data-key").substring(0,e.getAttribute("data-key").length-1);itemListName=i.match("(.*), "+s+" \\d+"),null!=itemListName&&2==itemListName.length&&(i=itemListName[1]),dkr.missingRequiredFieldsHandler.versionValues.getFieldFromControls(i).then((e=>{null!=e&&(0==e.fieldName.indexOf("SubElems")?n.push(e.fieldName):dkr.missingRequiredFieldsHandler.erroneousFields.push(e.fieldName),console.log("Adding required field :"+e.fieldName))}))})),dkr.missingRequiredFieldsHandler.erroneousFields=dkr.missingRequiredFieldsHandler.erroneousFields.concat(n),dkr.missingRequiredFieldsHandler.abortController.abort("Cleaning up listeners"),dkr.missingRequiredFieldsHandler.abortController=new AbortController,document.addEventListener("keydown",dkr.missingRequiredFieldsHandler.tabEventListener,{signal:dkr.missingRequiredFieldsHandler.abortController.signal})},dkr.missingRequiredFieldsHandler.tabEventListener=function(e){if("Tab"===e.key){const r=document.activeElement;let s=r.parentNode;for(;s!=document;){if(s.classList&&s.classList.contains("form-field-panel-decorator")){let n=-1;for(i=0;i<dkr.missingRequiredFieldsHandler.erroneousFields.length;i++)if(dkr.missingRequiredFieldsHandler.erroneousFields[i].indexOf(s.id+"_")>-1){n=i;break}n>-1&&n<dkr.missingRequiredFieldsHandler.erroneousFields.length&&0==r.classList.contains("date-time-control__input")&&0==r.classList.contains("autocomplete-input__input")&&dkr.missingRequiredFieldsHandler.handleTabClickInErroneousField(e,r,n);break}s=s.parentNode}}},void 0===dkr.missingRequiredFieldsHandler.ModalContentObserver&&(dkr.missingRequiredFieldsHandler.abortController=new AbortController,dkr.missingRequiredFieldsHandler.observerCounter=0,dkr.missingRequiredFieldsHandler.ModalContentObserver=new MutationObserver(dkr.missingRequiredFieldsHandler.MutationCallback),dkr.missingRequiredFieldsHandler.ModalContentObserver.observe(document.getElementById("Modals"),{subtree:!0,childList:!0}),console.log("Missing required field observer created")),dkr.missingRequiredFieldsHandler.abortController.abort("Page reloaded, cleaning up listeners"),console.log("Missing required field handler loaded");